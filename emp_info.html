<!DOCTYPE html>
<html lang="ko-KR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js" integrity="sha512-4F1cxYdMiAW98oomSLaygEwmCnIP38pb4Kx70yQYqRwLVCs3DbRumfBq82T08g/4LJ/smbFGFpmeFlQgoDccgg=="></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    
    <link rel="stylesheet" href="emp_info.css" /> 
    <link rel="stylesheet" href="./style.css" />
    <script defer src="./script.js"></script>
    <title>직원 상세 정보</title>
</head>
<body>
    <div class="phone">
        <div class="statusbar">
            <div class="status-left">8:52</div>
            <img class="status-right" src="./icon/top.png">
        </div>

        <header class="topbar">
            <a href="emp_list.html" class="back" aria-label="뒤로가기">
                <img src="./icon/arrow.png" /> 
            </a>
            <h1 id="title"><span id="employee-name-title"></span> 직원 정보</h1>
            <button id="save-btn" class="save">저장</button>
        </header>

        <main class="content detail-content">
            <div class="profile-area">
                <img id="profile-image" src="icon/face.png" alt="직원 프로필" />
                <button class="edit-profile-btn"><img src="icon/edit.png" alt="수정 아이콘" /></button>
            </div>

            <div class="input-group">
                <label for="name">이름</label>
                <input type="text" id="name" readonly>
            </div>
            <div class="input-group">
                <label for="phone">연락처</label>
                <input type="tel" id="phone" readonly>
            </div>
            <div class="input-group">
                <label for="position">직책</label>
                <input type="text" id="position" readonly>
            </div>
            
            <div class="date-group">
                <div class="input-group">
                    <label for="birth">생년월일</label>
                    <input type="text" id="birth" class="date-input" readonly>
                </div>
                <div class="input-group">
                    <label for="contractStart">계약 시작일</label>
                    <input type="text" id="contractStart" class="date-input" readonly>
                </div>
            </div>

            <div class="salary-group">
                <div class="input-group">
                    <label for="hourlyWage">시급</label>
                    <input type="text" id="hourlyWage" readonly>
                </div>
                <div class="input-group">
                    <label for="nightPayMultiplier">야간 근로 가산</label>
                    <input type="text" id="nightPayMultiplier" readonly>
                </div>
            </div>
            
            <div class="checkbox-group">
                <div class="input-group">
                    <label for="weeklyHolidayEligible">주휴수당 지급 여부</label>
                    <input type="text" id="weeklyHolidayEligible" readonly>
                </div>
                <div class="input-group">
                    <label for="insurance">4대보험 적용 여부</label>
                    <input type="text" id="insurance" readonly>
                </div>
            </div>

            <label class="schedule-label">근무 시간표</label>
            <div class="schedule-list">
                </div>
            <button class="add-schedule-btn">+</button>
        </main>

        <nav class="bottombar" aria-label="하단탭">
            <div class="tab-item" data-target="index.html">
                <img src="./icon/home.png" alt="홈 아이콘" />
            </div>

            <div class="tab-item" data-target="index.html">
                <img src="./icon/calender.png" alt="캘린더 아이콘" />
            </div>

            <div class="tab-item" data-target="emp_list.html">
                <img src="./icon/people_blue.png" alt="사람 아이콘" />
            </div>

            <div class="tab-item" data-target="settle.html">
                <img src="./icon/page.png" alt="정산 아이콘" />
            </div>
        </nav>

        <div class="homebar"></div>
    </div>

</body>

<script src="../list.js"></script> 
<script>
    //URL에서 쿼리 파라미터(직원 ID)를 추출
    function getEmployeeIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = parseInt(urlParams.get('id')); 
        return !isNaN(id) ? id : null; 
    }

    //직원 데이터를 불러와 화면에 보여주기
    function loadEmployeeData(employeeId) {
        //employeeData 안 되면 에러 메시지
        if (typeof employeeData === 'undefined') {
            console.error("Error: employeeData is not loaded. Check list.js path.");
            alert("직원 데이터를 로드하지 못했습니다. 파일 경로를 확인하세요.");
            return;
        }

        const employee = employeeData.find(emp => emp.id === employeeId);

        if (!employee) {
            alert("해당 ID의 직원 정보를 찾을 수 없습니다.");
            return;
        }

        //기본 정보
        $('#employee-name-title').text(employee.name); 
        $('#name').val(employee.name);
        $('#phone').val(employee.phone);
        $('#position').val(employee.position);
        $('#birth').val(employee.birth);
        $('#contractStart').val(employee.contractStart);

        //급여/수당 정보
        $('#hourlyWage').val(`${employee.hourlyWage.toLocaleString()}원`);
        
        //야간 근로 가산 (변수명 수정)
        const nightPayPercent = (employee.nightPayMultiplier - 1) * 100;
        $('#nightPayMultiplier').val(`${nightPayPercent}%`);

        //주휴수당
        $('#weeklyHolidayEligible').val(employee.weeklyHolidayEligible ? 'O' : 'X'); 

        //4대 보험
        $('#insurance').val(employee.insurance ? 'O' : 'X');

        //근무 시간표 렌더링
        const scheduleList = $('.schedule-list');
        scheduleList.empty(); 

        //schedule 객체가 유효한지 확인
        if (employee.schedule) {
            for (const day in employee.schedule) {
                if (employee.schedule.hasOwnProperty(day)) {
                    const workTime = employee.schedule[day];
                    const breakTime = employee.breakTime && employee.breakTime[day] ? employee.breakTime[day] : '';

                    const breakTimeDisplay = breakTime ? ` (${breakTime})` : '';
                    const simpleScheduleItem = `
                        <div class="schedule-item">${day} ${workTime}${breakTimeDisplay}</div>
                    `;
                    
                    scheduleList.append(simpleScheduleItem);
                }
            }
        }
    }

    $(document).ready(function() {
        const employeeId = getEmployeeIdFromUrl();
        if (employeeId) {
            loadEmployeeData(employeeId);
        } else {
            console.error("표시할 직원 ID가 URL에 없습니다.");
        }
    });
</script>


</html>
